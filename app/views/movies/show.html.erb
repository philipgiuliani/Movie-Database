<div class="movie_description">
	<%= image_tag @movie.cover(:medium) %>
	<span class="information">
		<h2><%= truncate(@movie.title, length: 30, truncate_string: "...") %><%= "<small> - #{@movie.subtitle}</small>".html_safe unless @movie.subtitle.empty? %></h2>
		<span>Erscheinungsdatum:</span> <%= @movie.release_year %><br />
		<span>Dauer:</span> <%= t("text.movie.hours", count: @movie.length/60) %> <%= t("text.movie.minutes", count: @movie.length%60) %><br />
		<span>Größe:</span> <%= number_with_precision(@movie.size/1024.0, precision: 2) %> Gigabyte<br />
		<span>Qualität:</span> <%= Quality.find(@movie.quality_id).name %><br />
		<span>Gesehen von:</span> <%= t("text.movie.persons", count: @movie.seen_movies.count) %><br />
		<span>Kategorien:</span> <%= @movie.genres.map { |g| g.name }.join(", ") %>
	</span>
	<div class="clear"></div>

	<% if @current_user.has_seen?(@movie) %>
		<%= link_to "Gesehen", movie_seen_movie_path(@movie, 1), class: "button visited", method: :put %>
	<% else %>
		<%= link_to "Nicht gesehen", movie_seen_movie_path(@movie, 1), class: "button not_visited", method: :put %>
	<% end %>
</div>

<%= link_to "Bearbeiten", edit_movie_path(@movie) %>
<%= link_to "Löschen", movie_path(@movie), method: :delete %>

<div class="movie_ratings">
	<h2>Bewertung <small>von anderen Benutzern</small></h2>
	<% @movie.ratings.all(order: "created_at desc").each do |rating| %>

	<div class="rating">
		<%= image_tag rating.user.avatar(:small), class: "avatar" %>
		<div class="text">
			<%= link_to rating.user.full_name, user_path(rating.user) %> sagt,<br />
			<%= rating.comment %><br />
			<% if rating.user == @current_user %>
				<%= link_to "Edit", edit_movie_rating_path(@movie, rating) %>
				<%= link_to "Delete", movie_rating_path(@movie, rating), method: :delete %>
			<% end %>
		</div>
		<div class="ratings">
			<span>Gesamt:</span> <%= stars_images(rating.rating_average) %><br />
			<span>Film:</span> <%= stars_images(rating.rating_general) %><br />
			<span>Qualität:</span> <%= stars_images(rating.rating_quality) %><br />
		</div>
		<div class="clear"></div>
	</div>
	<% end %>

	<% unless @current_user.has_rated?(@movie) %>
		<h3>Bewertung schreiben</h3>
		<%= form_for [@movie, @rating] do |f| %>
			<% if @rating.errors.any? %>
			<ul>
				<% @rating.errors.full_messages.each do |msg| %>
					<li><%= msg %></li>
				<% end %>
			</ul>
			<% end %>
			<p>
				<%= f.label :rating_general %>
				<%= f.select :rating_general, 10.downto(0).to_a %>
			</p>
			<p>
				<%= f.label :rating_quality %>
				<%= f.select :rating_quality, 10.downto(0).to_a %>
			</p>
			<p>
				<%= f.label :comment %>
				<%= f.text_area :comment %>
			</p>
			<p><%= f.submit %></p>
		<% end %>
	<% end %>
</div>