<div class="movie_description">
	<%= image_tag @movie.cover(:medium) %>
	<span class="information">
		<h2><%= truncate(@movie.title, length: 30, truncate_string: "...") %><%= "<small> - #{@movie.subtitle}</small>".html_safe unless @movie.subtitle.empty? %></h2>
		<span>Erscheinungsjahr:</span> <%= @movie.release_year %><br />
		<span>Dauer:</span> <%= t("text.movie.hours", count: @movie.length/60) %> <%= t("text.movie.minutes", count: @movie.length%60) %><br />
		<span>Größe:</span> <%= number_with_precision(@movie.size/1024.0, precision: 2) %> Gigabyte<br />
		<span>Qualität:</span> <%= Quality.find(@movie.quality_id).name %><br />
		<span>Gesehen von:</span> <%= t("text.movie.persons", count: @movie.seen_movies.count) %><br />
		<span>Kategorien:</span> <%= truncate(@movie.genres.map { |g| g.name }.join(", "), length: 40, truncate_string: "...") %>
	</span>
	<div class="clear"></div>
	<%= render partial: "toggle_button" %>
</div>

<% if @current_user.is_admin? %>
	<%= link_to "Bearbeiten", edit_movie_path(@movie), class: "button small" %>
	<%= link_to "Löschen", movie_path(@movie), confirm: 'Bist du sicher, dass du diesen Film löschen willst?', class: "button small", method: :delete %>
<% end %>

<div class="movie_ratings">
	<% if @movie.ratings.count > 0 %>
		<h2>Bewertungen</h2>
		<% @movie.ratings.all(order: "created_at desc").each do |rating| %>
		<div class="rating">
			<%= image_tag rating.user.avatar(:small), class: "avatar" %>
			<div class="text">
				<%= link_to rating.user.full_name, user_path(rating.user), class: "profile_link" %> sagt,<br />
				<%= rating.comment %><br />
				<% if rating.user == @current_user %>
					<%= link_to "Bearbeiten", edit_movie_rating_path(@movie, rating), class: "button small" %>
					<%= link_to "Löschen", movie_rating_path(@movie, rating), method: :delete, class: "button small" %>
				<% end %>
			</div>
			<div class="ratings">
				<span>Gesamt:</span> <%= stars_images(rating.rating_average) %><br />
				<span>Film:</span> <%= stars_images(rating.rating_general) %><br />
				<span>Qualität:</span> <%= stars_images(rating.rating_quality) %><br />
			</div>
			<div class="clear"></div>
		</div>
		<% end %>
	<% end %>

	<% unless @current_user.has_rated?(@movie) %>
		<h3>Bewertung schreiben</h3>
		<%= form_for [@movie, @rating] do |f| %>
			<% if @rating.errors.any? %>
			<ul>
				<% @rating.errors.full_messages.each do |msg| %>
					<li><%= msg %></li>
				<% end %>
			</ul>
			<% end %>
			<p>
				<%= f.label :rating_general %>
				<%= f.select :rating_general, 10.downto(0).to_a %>
			</p>
			<p>
				<%= f.label :rating_quality %>
				<%= f.select :rating_quality, 10.downto(0).to_a %>
			</p>
			<p>
				<%= f.label :comment %>
				<%= f.text_area :comment %>
			</p>
			<p><%= f.submit %></p>
		<% end %>
	<% end %>
</div>